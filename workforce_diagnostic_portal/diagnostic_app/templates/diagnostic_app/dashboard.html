{% extends 'diagnostic_app/base.html' %}

{% block title %}Dashboard{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Welcome, {{ user.get_role_display }} {{ user.username }}</h1>
    <div style="display: flex; align-items: center; gap: 10px; margin-top: 10px;">
        <span style="padding: 6px 12px; background: #f3f4f6; border-radius: 20px; font-size: 14px;">
            Level {{ user.get_level }}
            {% if user.get_level == 1 %} ‚Äì Strategic / Ownership
            {% elif user.get_level == 2 %} ‚Äì Execution / Delivery
            {% else %} ‚Äì HR / Operations Support
            {% endif %}
        </span>
        {% if user.can_create_job_roles %}
        <span style="padding: 6px 12px; background: #dbeafe; color: #1d4ed8; border-radius: 20px; font-size: 14px;">
            Can Create Job Roles
        </span>
        {% endif %}
    </div>
</div>

<!-- Stats Cards -->
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 40px;">
    <div class="card">
        <div style="display: flex; align-items: center; gap: 15px;">
            <div style="width: 50px; height: 50px; background: #dbeafe; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 24px;">
                üìä
            </div>
            <div>
                <h3 style="font-size: 28px; margin-bottom: 5px;">{{ stats.total_jobs }}</h3>
                <p style="color: #6b7280;">Total Job Roles</p>
            </div>
        </div>
    </div>
    
    <div class="card">
        <div style="display: flex; align-items: center; gap: 15px;">
            <div style="width: 50px; height: 50px; background: #fef3c7; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 24px;">
                üë§
            </div>
            <div>
                <h3 style="font-size: 28px; margin-bottom: 5px;">{{ stats.assigned_jobs }}</h3>
                <p style="color: #6b7280;">Assigned to You</p>
            </div>
        </div>
    </div>
    
    <div class="card">
        <div style="display: flex; align-items: center; gap: 15px;">
            <div style="width: 50px; height: 50px; background: #d1fae5; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 24px;">
                ‚úÖ
            </div>
            <div>
                <h3 style="font-size: 28px; margin-bottom: 5px;">{{ stats.completed }}</h3>
                <p style="color: #6b7280;">Completed</p>
            </div>
        </div>
    </div>
    
    <div class="card">
        <div style="display: flex; align-items: center; gap: 15px;">
            <div style="width: 50px; height: 50px; background: #f3e8ff; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 24px;">
                ‚è≥
            </div>
            <div>
                <h3 style="font-size: 28px; margin-bottom: 5px;">{{ stats.pending }}</h3>
                <p style="color: #6b7280;">Pending</p>
            </div>
        </div>
    </div>
</div>

<!-- Quick Actions -->
{% if user.can_create_job_roles %}
<div style="margin-bottom: 40px;">
    <h2 style="margin-bottom: 20px;">Quick Actions</h2>
    <div style="display: flex; gap: 15px;">
        <a href="{% url 'create_job_role' %}" class="btn btn-primary">
            ‚ûï Create New Job Role
        </a>
        <a href="{% url 'job_roles' %}" class="btn btn-secondary">
            üë• View All Job Roles
        </a>
    </div>
</div>
{% endif %}

<!-- Recent Job Roles -->
<div style="margin-bottom: 40px;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h2>Recent Job Roles</h2>
        <a href="{% url 'job_roles' %}" class="btn btn-secondary">View All</a>
    </div>
    
    {% if jobs %}
    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px;">
        {% for job in jobs %}
        <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px;">
                <div>
                    <h3 style="margin-bottom: 5px;">{{ job.title }}</h3>
                    <p style="color: #6b7280; font-size: 14px;">{{ job.department }}</p>
                </div>
                <span style="padding: 4px 10px; background: 
                    {% if job.urgency == 'high' %}#fee2e2; color: #991b1b;
                    {% elif job.urgency == 'medium' %}#fef3c7; color: #92400e;
                    {% else %}#d1fae5; color: #065f46;
                    {% endif %}; border-radius: 20px; font-size: 12px;">
                    {{ job.urgency|upper }}
                </span>
            </div>
            
            <p style="color: #6b7280; font-size: 14px; margin-bottom: 15px;">
                {{ job.description|truncatewords:20 }}
            </p>
            
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <span style="color: #6b7280; font-size: 14px;">üí∞ {{ job.budget_range }}</span>
                </div>
                <a href="{% url 'job_role_detail' job.id %}" class="btn btn-sm btn-primary">View</a>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="card">
        <p style="color: #6b7280; text-align: center; padding: 40px 0;">
            No job roles available yet.
            {% if user.can_create_job_roles %}
            <br><a href="{% url 'create_job_role' %}" style="color: #3b82f6;">Create your first job role</a>
            {% endif %}
        </p>
    </div>
    {% endif %}
</div>

<!-- Notifications -->
<div>
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h2>Recent Notifications</h2>
        <a href="{% url 'notifications' %}" class="btn btn-secondary">View All</a>
    </div>
    
    {% if notifications %}
    <div class="card">
        {% for notification in notifications %}
        <div style="padding: 15px; {% if not forloop.last %}border-bottom: 1px solid #e5e7eb;{% endif %}">
            <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                <div style="flex: 1;">
                    <div style="font-weight: 600; margin-bottom: 5px;">{{ notification.message }}</div>
                    {% if notification.job_role %}
                    <div style="color: #6b7280; font-size: 14px;">Job: {{ notification.job_role.title }}</div>
                    {% endif %}
                </div>
                <div style="color: #6b7280; font-size: 14px; text-align: right;">
                    {{ notification.created_at|timesince }} ago
                    {% if not notification.is_read %}
                    <span style="display: inline-block; width: 8px; height: 8px; background: #3b82f6; border-radius: 50%; margin-left: 5px;"></span>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="card">
        <p style="color: #6b7280; text-align: center; padding: 40px 0;">
            No new notifications.
        </p>
    </div>
    {% endif %}
</div>
{% endblock %}